<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login User - EduLearn</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="login-container">
        <!-- Back Button -->
        <button class="back-btn" onclick="window.location.href='index.html'">
            <i class="fas fa-arrow-left"></i> Kembali
        </button>
        
        <div class="login-wrapper">
            <!-- Left Panel -->
            <div class="login-left">
                <!-- ... konten yang sudah ada ... -->
            </div>
            
            <!-- Right Panel -->
            <div class="login-right">
                <div class="form-container">
                    <h2>Login Mahasiswa</h2>
                    <p>Masuk ke akun Anda untuk melanjutkan</p>
                    
                    <form id="userLoginForm">
                        <div class="form-group">
                            <label for="email">EMAIL</label>
                            <input type="email" id="email" class="form-field" 
                                   placeholder="student@email.ac.id" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">PASSWORD</label>
                            <div class="password-container">
                                <input type="password" id="password" class="form-field" 
                                       placeholder="Masukkan password" required>
                                <button type="button" class="password-toggle" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="rememberMe">
                                <span>Ingat saya</span>
                            </label>
                            <a href="#" class="forgot-password">Lupa password?</a>
                        </div>
                        
                        <button type="submit" class="btn-login" id="loginButton">
                            <i class="fas fa-sign-in-alt"></i>
                            <span id="loginText">Login</span>
                            <div class="spinner hidden" id="loginSpinner"></div>
                        </button>
                        
                        <!-- Error Message -->
                        <div class="alert alert-danger hidden" id="errorMessage"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Include JavaScript -->
    <script src="auth.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle password visibility
        const toggleBtn = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        
        toggleBtn.addEventListener('click', function() {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            this.querySelector('i').classList.toggle('fa-eye');
            this.querySelector('i').classList.toggle('fa-eye-slash');
        });
        
        // Handle form submission
        const form = document.getElementById('userLoginForm');
        const loginBtn = document.getElementById('loginButton');
        const loginText = document.getElementById('loginText');
        const loginSpinner = document.getElementById('loginSpinner');
        const errorMsg = document.getElementById('errorMessage');
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Validasi
            if (!email || !password) {
                showError('Email dan password harus diisi');
                return;
            }
            
            // Show loading
            loginBtn.disabled = true;
            loginText.textContent = 'Memproses...';
            loginSpinner.classList.remove('hidden');
            errorMsg.classList.add('hidden');
            
            try {
                // Panggil API login
                const result = await auth.loginUser(email, password);
                
                if (result.success) {
                    // Login berhasil, redirect ke dashboard
                    showSuccess('Login berhasil! Mengarahkan...');
                    
                    setTimeout(() => {
                        window.location.href = 'user-dashboard.html';
                    }, 1500);
                    
                } else {
                    // Login gagal
                    showError(result.message);
                    resetLoginButton();
                }
                
            } catch (error) {
                console.error('Login error:', error);
                showError('Terjadi kesalahan. Coba lagi nanti.');
                resetLoginButton();
            }
        });
        
        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.classList.remove('hidden');
        }
        
        function showSuccess(message) {
            errorMsg.textContent = message;
            errorMsg.classList.remove('hidden');
            errorMsg.classList.remove('alert-danger');
            errorMsg.classList.add('alert-success');
        }
        
        function resetLoginButton() {
            loginBtn.disabled = false;
            loginText.textContent = 'Login';
            loginSpinner.classList.add('hidden');
        }
        
        // Cek session jika sudah login
        auth.checkSession().then(result => {
            if (result.loggedIn && result.role !== 'admin') {
                window.location.href = 'user-dashboard.html';
            }
        });
    });
    </script>
</body>
</html>